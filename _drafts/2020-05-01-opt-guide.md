---
layout: post
title: 
date: 2020-05-01 13:59
category: 
author: 
tags: []
summary: 
---

[redhat performance tuning guide](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/performance_tuning_guide/index)
[osc collection](https://www.osc.edu/resources/getting_started/howto/howto_collect_performance_data_for_your_program)
[osc tuning](https://www.osc.edu/resources/getting_started/howto/howto_tune_performance)

```
ltrace: trace library call
strace: trace syscall
vtune
```

## tool

* valgrind
  * memcheck(default), cachegrind(cache and branch prediction), callgrind(cachegrind + call graph)
  * Helgrind, DRD, Massif(heap profiler?), DHAT

## computation

mkl: `export MKL_DEBUG_CPU_TYPE=5`

## memory 

mimalloc, tcmalloc, jemalloc, Hoard, TBB

[huge tlb](https://www.kernel.org/doc/html/latest/admin-guide/mm/hugetlbpage.html)
transparent huge pages (THP)

## pcie

https://blog.scottlowe.org/2009/12/02/what-is-sr-iov/
https://dshcherb.github.io/2019/02/02/interpreting-pcie-device-to-cpu-locality-information.html

### Single Root I/O Virtualization (SR-IOV)

Physial Function: actual pcie device
Virtual Function

### Message Signalled Interrupts

* pin-based interrupt (PCI)
  * pin count is limited -> cost
  * pins are shared between devices
  * out of band interrupt might race with in band data
    * requires synchronization -> performance cost
* MSI (PCI 2.2), MSI-X (PCI 3.0)
  * no interrupt pin in PCIe
  * device send data to processor as part of the interrupt
    * which determines what interrupt to trigger

## disk

storage performance development kit (SPDK)
`/sys/block/sda/queue/rotational`: turn off seek reordering for ssd
`/sys/block/sda/queue/rq_affinity`
`/sys/block/sda/queue/scheduler`

[queue sysfs](https://www.kernel.org/doc/Documentation/block/queue-sysfs.txt)
[tuning guide](https://www.broadcom.com/support/knowledgebase/1211161498420/performance-tuning-on-the-mr-sas-2108-lsi-sas-2208-sas-3108-base)
[smp affinity](https://www.broadcom.com/support/knowledgebase/1211161499716/configuring-smp-affinity-in-linux)
[block layer intro 1](https://lwn.net/Articles/736534/)
[block layer intro 2](https://lwn.net/Articles/738449/)

### block device

* block device operate in:
  * stacked drivers, ex: md (raid), dm (encrypt)
  * request, single queue
  * request, multi-queue (blk-mq)
  * `/sys/block/sda/queue/nr_requests`: block layer queue depth
* device driver can also have multiple queue:
  * `/sys/block/sda/device/queue_depth` driver queue depth
* to improve performance, we need to:
  * use multiple queue
  * low queue depth for latency
  * high queue depth for through put?

Quote [AWS EBS performance guide](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ebs-io-characteristics.html):
> If your workload is not delivering enough I/O requests to fully use the performance available to your EBS volume,
> then your volume might not deliver the IOPS or throughput that you have provisioned

[multiple queue block](https://lwn.net/Articles/552904/)

## executable packer

[UPX](https://github.com/upx/upx)

## nvidia

CUPTI 
nvprof
Visual Profiler (nvvp)
nsight

## network

data plane development kit (DPDK)
rdma

## cluster

openmpi
mpich
http://mvapich.cse.ohio-state.edu/
https://www.mpi-forum.org/docs/
https://github.com/goldsborough/ipc-bench
https://github.com/nanomsg/nng

rpc

https://github.com/uber/prototool#installation
https://github.com/bufbuild/buf

openshmem?
pgas Partitioned global address space
http://openshmem.org/site/

## parallel

* fail-stop faults
* split brain

https://support.ceci-hpc.be/doc/_contents/QuickStart/SubmittingJobs/SlurmTutorial.html

https://kubernetes.io/blog/2018/11/07/grpc-load-balancing-on-kubernetes-without-tears/

load balancing of http/2
https://www.nginx.com/blog/nginx-1-13-10-grpc/
