---
layout: post
title:
date: 2023-01-16 14:12
category:
author:
tags: []
summary:
---

[usb id](https://usb-ids.gowdy.us/)

## usb

- usb device works in master/slave arch
- otg: device determines its role based on which end of cable it is on
  - master: A device, ID pin grounded
  - slave: B device, ID pin floating
  - device role can be changed later via SRP or HNP
- usb c
  - A plug: downstream facing port (DFP)
  - B plug: upstream facing port (UFP)
  - dual role port (DRP)
    - otg is considered DRP in usb c's term
  - CC: configuration pin, used to determine role
    - pull up resistor -> DFP
    - pull down resistor -> UFP
    - DRP will alternate its resistor setting
  - Vconn: power for active cable
- Power domain
  - Source vs Sink
  - Host will assume the role of source
  - for otg, source is set via specific pull down resistance
  - for usb c, source is negotiated over USB PD

## device classes

- USB Video Class (UVC, 0Eh)
- Media (MTP, 06h)
- USB Mass Storage (08h)
- USB CDC (02h), USB CDC-Data (0Ah)?
  - ACM - virtual com
  - NCM - Ethernet Adapter
- RDNIS network

## Linux USB Gadget

https://developer.nvidia.com/video-encode-and-decode-gpu-support-matrix-new

First the device's USB controller needs to support this in hardware.
Search for "OTG mode" or "dwc2" together with your board's model.

(As a general rule, full-size type-A ports will never be able to act as a device.)

Once you have enabled the necessary hardware (e.g. loaded drivers for the dwc2 controller),
you can then load one of the "gadget" drivers in Linux.
There is `g_mass_storage` for emulating a USB storage device,
`g_serial` for emulating a USB-to-serial converter,
`g_ether` for emulating a USB-Ethernet adapter, and quite a few others.

### tegra

tegra XUSB OTG

https://lwn.net/Articles/807622/

https://www.kernel.org/doc/Documentation/devicetree/bindings/usb/nvidia%2Ctegra-xudc.yaml
